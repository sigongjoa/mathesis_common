syntax = "proto3";

package mathesis.common;

message Status {
  enum Code {
    OK = 0;
    CANCELLED = 1;
    UNKNOWN = 2;
    INVALID_ARGUMENT = 3;
    DEADLINE_EXCEEDED = 4;
    NOT_FOUND = 5;
    ALREADY_EXISTS = 6;
    PERMISSION_DENIED = 7;
    INTERNAL = 13;
    UNAVAILABLE = 14;
  }
  Code code = 1;
  string message = 2;
}

message Metadata {
  string id = 1;
  int64 created_at = 2;
  int64 updated_at = 3;
  map<string, string> tags = 4;
}

// Concept Service (Node1)
message Concept {
  string id = 1;
  string title = 2;
  string description = 3;
  repeated string parents = 4;
  repeated string children = 5;
  Metadata metadata = 6;
}

message GetConceptRequest {
  string id = 1;
}

message ListConceptsRequest {
  int32 page_size = 1;
  string page_token = 2;
}

message ListConceptsResponse {
  repeated Concept concepts = 1;
  string next_page_token = 2;
}

// Q-DNA Service (Node2)
message Question {
  string id = 1;
  string text = 2;
  string solution = 3;
  repeated string related_concepts = 4;
  Metadata metadata = 5;
}

service MathesisService {
  rpc GetConcept(GetConceptRequest) returns (Concept);
  rpc ListConcepts(ListConceptsRequest) returns (ListConceptsResponse);
  rpc GetQuestion(GetQuestionRequest) returns (Question);
  rpc AnalyzeProblem(AnalyzeProblemRequest) returns (AnalyzeProblemResponse);
}

message AnalyzeProblemRequest {
  string problem_text = 1;
}

message AnalyzeProblemResponse {
  string bloom_level = 1;
  int32 difficulty_score = 2;
  string reasoning = 3;
}

message GetQuestionRequest {
  string id = 1;
}
